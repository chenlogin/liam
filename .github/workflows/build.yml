name: 'Build and Deploy to GitHub Pages'

on:
  workflow_dispatch:
  push:
    branches: [main]
jobs:
  my_first_job:
    name: My first job
    # 运行所需要的虚拟机环境
    runs-on: ubuntu-latest
    # 每个 Job 的运行步骤
    steps:
    - name: Print a greeting
      env:
        MY_VAR: Hi there! My name is
        FIRST_NAME: C
        LAST_NAME: M
      run: |
        # 运行的命令或者 action
        echo $MY_VAR $FIRST_NAME $LAST_NAME.
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup node
        uses: actions/setup-node@v3
        with:
          node-version: 16.14.x
      - name: Install dependencies  
        run: yarn
        shell: bash
      - name: Build project  
        run: yarn build
        shell: bash  
      - name: List files  
        run: ls -l dist/
        shell: bash
      - name: Deploy to GitHub Pages
        # peaceiris/actions-gh-pages@v3这个Action它首先会检查gh-pages分支是否存在，如果不存在，则会创建该分支
        # ./dist 中的所有文件和文件夹复制到gh-pages分支的根目录下
        uses: peaceiris/actions-gh-pages@v3  
        with:  
          github_token: ${{ secrets.GITHUB_TOKEN }}  
          publish_dir: ../dist # 或者你的构建输出目录
          keep_files: false
          force_orphan: true
          commit_message: 'Deploy to GitHub Pages'
      
    # 隐私参数，如用户名、密码等，使用${{ secrets.XXX }}或者${{ env.XXX }}，参数可在setting里填写，避免泄漏
    # - name: upload file
    #   uses: kostyaten/ssh-server-deploy@v4
    #   with: 
    #     host: ${{ secrets.HOST }}
    #     username: ${{ secrets.USERNAME }}
    #     password: ${{ secrets.PASSWORD }}
    #     port: 22
    #     scp_source: "./dist"
    #     scp_target: ${{ secrets.TARGET }}